<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="qnaMapper">

	<resultMap type="qna" id="qnaResultSet">
		<result column = "QNA_NO" property = "qnaNo"/>
		<result column = "QNA_TITLE" property = "qnaTitle"/>
		<result column = "QNA_CATE_NO" property = "qnaCateNo"/>
		<result column = "QNA_CONTENT" property = "qnaContent"/>
		<result column = "QNA_ID" property = "qnaId"/>
		<result column = "CREATE_DATE" property = "createDate"/>
		<result column = "ANSWER_CONTENT" property = "answerContent"/>
		<result column = "ANSWER_DATE" property = "answerDate"/>
		<result column = "QNA_TYPE" property = "qnaType"/>
		<result column = "PRO_NO" property = "proNo"/>
		<result column = "QNA_STATUS" property = "qnaStatus"/>
		<result column = "ANS_STATUS" property = "ansStatus"/>
	</resultMap>
	
	<select id="selectQnaListCount" resultType="_int">
        SELECT COUNT(*)
		FROM QNA
		WHERE QNA_STATUS = 'Y'
		AND QNA_TYPE = 2
	</select>
	
	<select id="selectQnaList" resultMap="qnaResultSet">
        SELECT ROWNUM AS RNUM, A.* FROM(
        SELECT QNA_NO, QNA_ID, QNA_TITLE, CREATE_DATE, ANS_STATUS, ANSWER_CONTENT, CATE_NAME AS QNA_CATE_NO
        FROM QNA Q
        JOIN CATEGORY C
        ON Q.QNA_CATE_NO = C.CATE_NO
        WHERE QNA_STATUS = 'Y'
        AND QNA_TYPE = 2
        ORDER BY ANS_STATUS DESC, CREATE_DATE) A
        ORDER BY RNUM DESC
	</select>

	<select id="selectQna" resultMap="qnaResultSet">
        SELECT QNA_NO, QNA_TITLE, CREATE_DATE, QNA_CONTENT, ANSWER_CONTENT, ANSWER_DATE, CATE_NAME AS QNA_CATE_NO
		FROM QNA Q
        JOIN CATEGORY C
        ON Q.QNA_CATE_NO = C.CATE_NO
		WHERE QNA_NO = #{qNo}
	</select>
	
	<update id="insertQnaAns">
		UPDATE QNA
        SET ANSWER_CONTENT = #{answerContent},
            ANS_STATUS = 'Y',
            ANSWER_DATE = SYSDATE
        WHERE QNA_NO = #{qnaNo}
	</update>

</mapper>













